<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lights</title>
    <!-- <link rel="stylesheet" href="style.css"> -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Karla:ital,wght@0,200..800;1,200..800&family=Mulish:ital,wght@0,200..1000;1,200..1000&family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
 
        h1 {
            font-size: 32px;
            font-weight: 300;
            color: #444; /* Matches h1 in the original CSS */
        }

        p {
            font-size: 25px;
            font-weight: 300;
            text-align: left;
            padding: 5vh;
            margin-top: auto;
            margin-bottom: auto;
            color: #f9f9f9;
        }

        .room {
            width: 40vh;
            height: 100px;
            background-color: #007BFF;
            border-radius: 15px;
            position: relative;
            display: inline-block;
            margin-top: 20px; /* spacing between rectangles */
        }

        /* reference: https://www.w3schools.com/howto/howto_css_switch.asp */
        .switch {
            position: relative;
            bottom: 70px;
            left: 220px;
            display: inline-block;
            width: 60px;
            height: 34px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute; /* might need to remove */
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #68c151;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #68c151;
        }

        /* white part of button */
        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <h1>Alarms</h1>
    <div class="room one" id="master">
        <p>Master</p>
        <label class="switch">
            <input type="checkbox" unchecked>
            <span class ="slider round"></span>
        </label>
    </div>
    <div class="room two" id="living">
        <p>Living</p>
        <label class="switch">
            <input type="checkbox" unchecked>
            <span class ="slider round"></span>
        </label>
    </div>
    <div class="room three" id="entrance">
        <p>Entrance</p>
        <label class="switch">
            <input type="checkbox" unchecked>
            <span class ="slider round"></span>
        </label>
    </div>
    <div class="room four" id="guest">
        <p>Guest</p>
        <label class="switch">
            <input type="checkbox" unchecked>
            <span class ="slider round"></span>
        </label>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const switches = document.querySelectorAll('input[type="checkbox"]');
    
            // loading current alarm states from the server
            async function loadAlarmStates() {
                try {
                    const response = await fetch('http://localhost:3000/api/alarms'); // Endpoint to get all alarm states
                    const data = await response.json();
    
                    switches.forEach((switchElem) => {
                        const roomId = switchElem.closest('.room').id;
                        if (data[roomId]) {
                            switchElem.checked = (data[roomId] === "Active");
                        }
                    });
                } catch (error) {
                    console.error('Error loading alarm states:', error);
                }
            }
    
            // updating alarm state on toggle using jQuery AJAX
            function updateAlarmState(alarm, state) {
                console.log('Updating alarm:', alarm, 'State:', state); // Log alarm name and state
                $.ajax({
                    url: `http://localhost:3000/api/alarm/${alarm}`, // Target API endpoint
                    type: 'PUT', // Method for updating
                    contentType: 'application/json', // Set content type to JSON
                    data: JSON.stringify({ status: state }), // Send data as JSON
                    success: function(responseData) {
                        console.log('Alarm updated successfully:', responseData);
                    },
                    error: function(xhr, status, error) {
                        console.error('Error updating alarm state:', error);
                    }
                });
            }

            // attaching event listeners to toggle switches
            switches.forEach((switchElem) => {
                switchElem.addEventListener('change', (event) => {
                    const alarmId = event.target.closest('.room').id;
                    const newState = event.target.checked ? "Active" : "Inactive";
                    updateAlarmState(alarmId, newState);
                });
            });
    
            // initialising the switches
            loadAlarmStates();
        });
    </script>
</body>
</html>